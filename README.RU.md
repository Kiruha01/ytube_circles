# YouTube Video Circle Bot

[English description](./README.RU.md)

## Описание

**YouTube Video Circle Bot** — это Telegram-бот, который преобразует видео с YouTube в кружки телеграма на основе предоставленных ссылок и временных меток. Пользователи могут указать URL-адрес видео на YouTube, время начала и длительность, чтобы создать короткий видеоклип, оптимизированный для формата видеосообщений Telegram.

Бот написан на языке Go, использует FFmpeg для обработки видео и упакован в Docker-контейнер для удобного развертывания. Поддерживаются два режима получения обновлений от Telegram: long polling и webhook.

## Возможности

- Преобразование YouTube-видео в круговые видеосообщения.
- Поддержка указания времени начала и длительности (например, `https://youtu.be/dQw4w9WgXcQ 00:00:43 10` для 10-секундного клипа, начиная с 43-й секунды).
- Обработка полных URL YouTube и коротких ссылок `youtu.be`.
- Настройка через переменные окружения.
- Поддержка прокси для запросов к YouTube API.
- Упаковка в Docker для удобного развертывания.

## Требования

- **Go**: Версия 1.23 или выше (для разработки).
- **Docker**: Для сборки и запуска контейнеризированного приложения.
- **FFmpeg**: Требуется для обработки видео (включен в Docker-образ).
- **Токен Telegram-бота**: Получите у [BotFather](https://t.me/BotFather).

## Установка

1. **Клонируйте репозиторий**:
   ```bash
   git clone <repository-url>
   cd <repository-directory>
   ```

2. **Настройте переменные окружения**:
   Создайте файл `.env` в корне проекта со следующим содержимым:
   ```
   TELEGRAM_BOT_TOKEN=ваш-токен-telegram-бота
   WH_URL=https://webhook-url (опционально, для режима webhook)
   PROXY_URL=http://http-прокси-url (опционально)
   STORAGE_PATH=storage
   FFMPEG_BIN=ffmpeg
   ```
   Либо задайте эти переменные в вашей среде.

   Для запуска в режиме long pooling не указывайте `WH_URL`.

3. **Установите зависимости**:
   ```bash
   go mod download
   ```

4. **Запустите локально** (без Docker):
   ```bash
   go run main.go
   ```

## Сборка и запуск с помощью Docker

1. **Соберите Docker-образ**:
   ```bash
   ./build_image.sh [-y] <версия>
   ```
   - `-y`: Автоматическое подтверждение всех запросов.
   - `<версия>`: Укажите версию образа (например, `1.0`).

   Пример:
   ```bash
   ./build_image.sh -y 1.0
   ```

2. **Запустите Docker-контейнер**:
   ```bash
   docker run -d --env-file .env kiruha01/yt_circles:<версия>
   ```

## Использование

1. Запустите бота, отправив команду `/start` или `/help` в Telegram.
2. Отправьте ссылку на YouTube-видео с опциональными параметрами времени начала и длительности:
   ```
   https://youtu.be/dQw4w9WgXcQ 00:00:43 10
   ```
   - Поддерживаемые форматы:
     - `https://youtube.com/...` или `https://youtu.be/...`
     - Время начала: `ЧЧ:ММ:СС` или секунды (например, `43`).
     - Длительность: Секунды или `ЧЧ:ММ:СС` (по умолчанию/максимум: 60 секунд).
   - Примеры:
     - `https://youtu.be/dQw4w9WgXcQ 00:00:43 10`: Клип с 43-й по 53-ю секунду.
     - `https://youtu.be/dQw4w9WgXcQ 43`: Клип с 43-й по 103-ю секунду.
     - `https://youtu.be/dQw4w9WgXcQ`: Клип с 0-й по 60-ю секунду.

3. Бот обработает видео и отправит круговое видеосообщение, а затем название видео.

## Структура проекта

- `main.go`: Точка входа приложения.
- `config/`: Загрузка и схема конфигурации.
- `telegram/`: Логика Telegram-бота, включая режимы long polling и webhook.
- `ytVideoMaker/`: Загрузка и обработка видео с YouTube.
- `build_image.sh`: Скрипт для сборки и публикации Docker-образов.
- `Dockerfile`: Многоступенчатый Dockerfile для сборки приложения.
